let currentSort = { column: null, direction: 1 };

function colorize(value) {
    if (value === null || value === undefined || isNaN(value)) return "-";

    if (value >= 10) return `<span style="color:#00c853;font-weight:600">${value.toFixed(1)}</span>`;
    if (value >= 5)  return `<span style="color:#ffd600;font-weight:600">${value.toFixed(1)}</span>`;
    if (value > 0)   return `<span style="color:#ff9100;font-weight:600">${value.toFixed(1)}</span>`;
    return `<span style="color:#ff1744;font-weight:600">${value.toFixed(1)}</span>`;
}

export function renderTable(data) {

    function sortData(column) {
        if (currentSort.column === column) {
            currentSort.direction *= -1;
        } else {
            currentSort.column = column;
            currentSort.direction = 1;
        }

        data.sort((a, b) => {
            const A = a[column] ?? 0;
            const B = b[column] ?? 0;
            return (A - B) * currentSort.direction;
        });
    }

    let html = `
        <table>
            <thead>
                <tr onclick="window.showCharts(i)" style="cursor:pointer">
                    <th onclick="window.sortTable('match')">Match</th>
                    <th onclick="window.sortTable('win_prob_home')">Win H%</th>
                    <th onclick="window.sortTable('win_prob_away')">Win A%</th>
                    <th onclick="window.sortTable('edge_home')">Edge H</th>
                    <th onclick="window.sortTable('edge_away')">Edge A</th>
                    <th onclick="window.sortTable('P_spread_home_cover')">Spread Cover</th>
                    <th onclick="window.sortTable('P_total_over')">Total Over</th>
                </tr>
            </thead>
            <tbody>
    `;

    for (const g of data) {
        html += `
            <tr onclick="window.showCharts(i)" style="cursor:pointer">
                <td>${g.home} - ${g.away}</td>
                <td>${(g.win_prob_home * 100).toFixed(1)}%</td>
                <td>${(g.win_prob_away * 100).toFixed(1)}%</td>

                <td>${colorize(g.edge_home)}</td>
                <td>${colorize(g.edge_away)}</td>
                <td>${colorize(g.P_spread_home_cover)}</td>
                <td>${colorize(g.P_total_over)}</td>
            </tr>
        `;
    }

    html += "</tbody></table>";

    document.getElementById("table").innerHTML = html;
<tr onclick="window.showCharts(i)" style="cursor:pointer">

    window.sortTable = (col) => {
        sortData(col);
        renderTable(data);
    };
}
